<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

</head>
    <meta charset="UTF-8">
    <title>TURQUOISE Admin Panel</title>
    <style>
	body {
    margin: 0;
    font-family: 'Arial', sans-serif;
}

.navbar {
    background-color: #176B87; /* Dark shade for navbar */
    color: #fff;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between; /* Aligns content on opposite ends */
    align-items: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Subtle shadow for depth */
	border-radius: 5px;
}

.navbar-content {
    display: flex;
    align-items: center;
}

.page-name {
    font-size: 1.5rem;
    font-weight: 500;
    margin-right: 20px; /* Space between page name and user info */
}

.user-info {
    display: flex;
    align-items: center;
}

.user-name {
    font-size: 1rem;
    margin-right: 10px;
}

.user-avatar {
    width: 40px; /* Adjust size as necessary */
    height: 40px;
    border-radius: 50%; /* Circular avatar */
    border: 2px solid #fff; /* White border for contrast */
}



        #sidebar {
    width: 250px;
    background: linear-gradient(165deg, #145B77 30%, #176B87 100%); /* Subtle gradient */
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    padding-top: 20px;
    box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    z-index: 1000; /* Ensure sidebar is always on top */
}

#sidebar #logo {
    text-align: center;
    margin-bottom: 20px;
}

#sidebar #logo img {
    width: 100px; /* Slightly larger logo */
    height: 100px;
    border-radius: 50%; /* Perfect circle */
    margin-bottom: 10px;
}

#sidebar #logo h1 {
    color: #fff;
    font-size: 24px; /* Adjusted for better visibility */
    font-weight: bold;
}

#sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

#sidebar ul li {
    position: relative;
    padding: 10px 20px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px; /* Rounded edges */
    transition: background-color 0.3s ease; /* Smooth transition */
}

#sidebar ul li a {
    color: #fff;
    text-decoration: none;
    display: flex; /* Aligns icons and text */
    align-items: center; /* Centers items vertically */
}

#sidebar ul li a i { /* Icon styling */
    margin-right: 10px; /* Space between icon and text */
    font-size: 18px; /* Icon size */
}

#sidebar ul li.active, #sidebar ul li:hover { /* Active/Hover state */
    background-color: #ddf1ff; 
    color: #176B87; /* Adjust as needed */
}

#sidebar ul li.active a, #sidebar ul li:hover a { /* Active/Hover link state */
    color: #176B87; /* Adjust as needed */
}
        
        #content {
            margin-left: 260px;
            padding: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            border-radius: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #C7E0F4;
            color: #000;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .actions {
            text-align: center;
        }
        .remove-link {
            color: red;
            cursor: pointer;
        }
		#overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1;
}

#popup {
    display: none;
    position: fixed;
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    z-index: 2;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

#popup label {
    display: block;
    margin-bottom: 10px;
}

#popup input {
    width: 100%;
    padding: 8px;
    margin-bottom: 15px;
    box-sizing: border-box;
}

#popup button {
    background-color: #176B87;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 10px;
    cursor: pointer;
	
}

#popup button:hover {
    background-color: #125669;
}

.custom-card {
    border: none;
    overflow: hidden;
}

.search-container {
    flex-grow: 1;
    max-width: 400px;
    margin-right: 30px;
}

.rounded-input {
    border-radius: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.rounded-button {
    border-radius: 20px;
    background: linear-gradient(45deg, #176B87, #2091B9);
    color: #fff;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.custom-table {
    background-color: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border-collapse: separate;
    border-spacing: 0 15px; /* Adds space between rows */
}

.custom-table th {
    background-color: #176B87;
    color: #FFFFFF;
    padding: 15px;
    text-align: left;
    font-weight: normal; /* For a lighter header look */
}

.custom-table td {
    padding: 15px;
    background-color: #FAFAFA; /* Light background for rows */
    border-bottom: 1px solid #ECECEC; /* Subtle border for separation */
}

.custom-table tr:hover {
    background-color: #f2f2f2; /* Slight color change on hover */
    cursor: pointer; /* Change cursor to indicate interactiveness */
}

.button-spaced {
    margin-right: 10px;
}

    </style>
</head>
<body>
    <div id="sidebar">
        <div id="logo">
            <img src="sir al min school.png" alt="Sir Al Min School Logo">
            <h1>TURQUOISE</h1>
        </div>
        <ul>
            <li><a href="landingpage.html"><i class="fa fa-home"></i> Landing page</a></li>
        <li><a href="teacher.html"><i class="fa fa-user"></i> Teachers List</a></li>
        <li><a href="view.html"><i class="fa fa-users"></i> Students List</a></li>
		<li><a href="user.html"><i class="fa fa-users"></i> User List</a></li>
        </ul>
    </div>
    <div id="content">
	<nav class="navbar">
    <div class="navbar-content">
        <span class="page-name">Students List</span> <!-- Dynamic current page name -->
        
    </div>
</nav>




		<br>
		<div class="container mt-4">
    <div class="card rounded-lg shadow-lg custom-card"> <!-- Enhanced shadow and overflow -->
        <div class="card-body">
            <!-- Search and Add button -->
            <div class="d-flex justify-content-between mb-4">
                <div class="search-container">
                    <input type="text" id="search" class="form-control rounded-input" placeholder="Search Student" oninput="searchTeacher()"> <!-- Input shadow -->
                </div>
                <button id="addStudentButton" class="btn btn-primary rounded-button">Add Student</button> <!-- Gradient button -->
            </div>
            
            <!-- Modern Table -->
            <div class="table-responsive">
                <table id="studentTable" class="table custom-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Class Name</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Teacher data will be inserted here by the fetchTeacherRecords function -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function confirmDelete(rowIndex) {
            var table = document.querySelector("table");
            var name = table.rows[rowIndex].cells[0].innerText;

            if (confirm("Are you sure you want to delete " + name + "?")) {
                table.deleteRow(rowIndex);
            }
        }

        


		
		
    
function downloadList() {
            var table = document.querySelector("table");
            var rows = table.rows;
            var csvContent = "data:text/csv;charset=utf-8,";

            for (var i = 0; i < rows.length; i++) {
                var cells = rows[i].cells;
                var rowText = [];

                for (var j = 0; j < cells.length; j++) {
                    rowText.push(cells[j].innerText);
                }

                csvContent += rowText.join(",") + "\n";
            }

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "student_list.csv");
            document.body.appendChild(link);
            link.click();
        }
</script>
    <!-- Your existing scripts -->
    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
  import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyA8vydj3oJu9g90W7jVKyjY7NQzvtUUTko",
    authDomain: "turquoise-9d090.firebaseapp.com",
    projectId: "turquoise-9d090",
    storageBucket: "turquoise-9d090.appspot.com",
    messagingSenderId: "942530582497",
    appId: "1:942530582497:web:67204c20d2ebdb7a3d64a0",
    measurementId: "G-0RE20PDVEN"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);
  
  /// Fetch and display student records
  async function fetchStudentRecords() {
  const tableBody = document.querySelector("#studentTable tbody");
  tableBody.innerHTML = ""; // Clear existing table rows

  // Fetch student data from Firestore
  const querySnapshot = await getDocs(collection(db, "Turquoise", "Students", "PersonalInfo"));

  // Process each document in the snapshot
  querySnapshot.forEach((doc) => {
    const studentName = doc.data().Name;
    const className = doc.data().Class;
    const docId = doc.id; // The document ID from Firestore

    const row = tableBody.insertRow();
    row.insertCell(0).innerText = studentName;
    row.insertCell(1).innerText = className;

    // Create the action cell for edit and delete icons
    const actionCell = row.insertCell(2);

    // Create an edit icon
    const editIcon = document.createElement('img');
    editIcon.setAttribute('src', 'https://img.icons8.com/ios-filled/50/edit--v1.png');
    editIcon.setAttribute('alt', 'edit icon');
    editIcon.style.cursor = 'pointer';
    editIcon.setAttribute('width', '16');
    editIcon.setAttribute('height', '16');
    // Add an event listener to the edit icon that calls the openEditPopup function
    editIcon.addEventListener('click', function() {
      openEditPopup(docId, studentName, className);
    });
    actionCell.appendChild(editIcon);

    // Create a delete icon
    const deleteIcon = document.createElement('img');
    deleteIcon.setAttribute('src', 'https://img.icons8.com/ios/50/delete--v1.png');
    deleteIcon.setAttribute('alt', 'delete icon');
    deleteIcon.style.cursor = 'pointer';
    deleteIcon.setAttribute('width', '16');
    deleteIcon.setAttribute('height', '16');
    // Add an event listener to the delete icon that calls confirmDelete
    deleteIcon.addEventListener('click', function() {
      confirmDelete(docId);
    });
    actionCell.appendChild(deleteIcon);
  });




  // Enable search once data is loaded
  enableSearch();
}

function openEditPopup(docId, currentName, currentClass) {
 let existingOverlay = document.getElementById("overlay");
  if (existingOverlay) {
    existingOverlay.remove();
  }
  let existingPopup = document.getElementById("popup");
  if (existingPopup) {
    existingPopup.remove();
  }

  // Create the overlay
  var overlay = document.createElement("div");
  overlay.id = "overlay";
  overlay.addEventListener('click', function(event) {
    event.stopPropagation(); // Prevent click from closing the popup
  });
  document.body.appendChild(overlay);

  // Create the popup container
  var popup = document.createElement("div");
  popup.id = "popup";
  popup.addEventListener('click', function(event) {
    event.stopPropagation(); // Prevent click from closing the popup
  });
  document.body.appendChild(popup);

    // Create input fields and labels for student name and class
    var studentLabel = document.createElement("label");
    studentLabel.innerText = "Student Name:";
    var studentInput = document.createElement("input");
    studentInput.type = "text";

    var classLabel = document.createElement("label");
    classLabel.innerText = "Class Name:";
    var classInput = document.createElement("input");

  // Pre-populate input fields with current values
  studentInput.value = currentName;
  classInput.value = currentClass;

  // Create a save button instead of an add button
  var saveButton = document.createElement("button");
saveButton.innerText = "Save Changes";
saveButton.classList.add("button-spaced");
saveButton.addEventListener('click', function() {
  // Update the student data in Firestore
  const updatedName = studentInput.value;
  const updatedClass = classInput.value;

  // Reference the specific document in Firestore
  const studentRef = doc(db, "Turquoise", "Students", "PersonalInfo", docId);

  // Send the update to Firestore
  updateDoc(studentRef, {
    Name: updatedName,
    Class: updatedClass
  })
  .then(() => {
    alert("Record updated successfully.");
    // Refresh the list or table
    fetchStudentRecords();
    // Remove the popup and overlay from the DOM
    document.body.removeChild(popup);
    document.body.removeChild(overlay);
  })
  .catch((error) => {
    console.error("Error updating document: ", error);
    alert("Error updating record. Please try again.");
  });
});



// Create a cancel button
var cancelButton = document.createElement("button");
cancelButton.innerText = "Cancel";
cancelButton.addEventListener('click', function() {
  // Remove the popup and overlay from the DOM
  document.body.removeChild(popup);
  document.body.removeChild(overlay);
});

   // Append elements to the popup
    popup.appendChild(studentLabel);
    popup.appendChild(studentInput);
    popup.appendChild(classLabel);
    popup.appendChild(classInput);
    popup.appendChild(saveButton);
    popup.appendChild(cancelButton);

    // Center the popup on the screen
    var popupWidth = 300; // Adjust the width as needed
    var popupHeight = 200; // Adjust the height as needed
    popup.style.left = (window.innerWidth - popupWidth) / 2 + "px";
    popup.style.top = (window.innerHeight - popupHeight) / 2 + "px";

    // Make overlay and popup visible
    overlay.style.display = "block";
    popup.style.display = "block";
}


async function confirmDelete(docId) {
    if (confirm("Are you sure you want to delete this record?")) {
        const docRef = doc(db, "Turquoise", "Students", "PersonalInfo", docId);
        await deleteDoc(docRef)
            .then(() => {
                alert("Record deleted successfully.");
                fetchStudentRecords(); // Refresh the list or table
            })
            .catch((error) => {
                console.error("Error removing document: ", error);
                alert("Error deleting record. Please try again.");
            });
    }
}

// Function to initialize and control search functionality
function enableSearch() {
  const searchInput = document.getElementById("search");

  searchInput.addEventListener("input", (event) => {
    const searchTerm = event.target.value.toLowerCase();

    // Delay search by 250ms to allow potential data fetching
    setTimeout(() => {
      searchStudents(searchTerm);
    }, 250);
  });
}

// Function to perform actual search after delay
function searchStudents(term) {
  const tableBody = document.querySelector("#studentTable tbody");
  const rows = tableBody.rows;

  // Compare search term with all student names (lowercase)
  for (let i = 0; i < rows.length; i++) {
    const studentName = rows[i].cells[0].innerText.toLowerCase();
    const matchFound = studentName.includes(term);

    rows[i].style.display = matchFound ? "" : "none";
  }
}

// Start data fetching and initialize search after data is loaded
fetchStudentRecords().then(enableSearch);

function openAddStudentPopup() {
    // Create a modal overlay
    var overlay = document.createElement("div");
    overlay.id = "overlay";
    document.body.appendChild(overlay);

    // Create the popup container
    var popup = document.createElement("div");
    popup.id = "popup";
    document.body.appendChild(popup);

    // Create input fields and labels for student name and class
    var studentLabel = document.createElement("label");
    studentLabel.innerText = "Student Name:";
    var studentInput = document.createElement("input");
    studentInput.type = "text";

    var classLabel = document.createElement("label");
    classLabel.innerText = "Class Name:";
    var classInput = document.createElement("input");
	
	 var submitButton = document.createElement("button");
  submitButton.innerText = "Add Student";
  submitButton.classList.add("button-spaced");
  submitButton.onclick = function () {
    // Save the student data to Firestore
    const studentName = studentInput.value;
    const className = classInput.value;

    // Access the "PersonalInfo" collection in Firestore
    const personalInfoRef = collection(db, "Turquoise", "Students", "PersonalInfo");

    // Add a new document with the student's information
    addDoc(personalInfoRef, {
      Name: studentName,
      Class: className,
	  addedTimestamp: serverTimestamp()
    })
      .then(() => {
        
  // Data added successfully, update the table
  fetchStudentRecords(); // Assuming this function updates the table

  // Provide user feedback
  alert("Student added successfully!");

  

        // Remove the popup and overlay
        document.body.removeChild(popup);
        document.body.removeChild(overlay);
      })
      .catch((error) => {
        console.error("Error adding document: ", error);
        alert("Error adding student. Please try again.");
      });
  };
  // Create a cancel button
    var cancelButton = document.createElement("button");
    cancelButton.innerText = "Cancel";
    cancelButton.onclick = function () {
        // Remove the popup and overlay
        document.body.removeChild(popup);
        document.body.removeChild(overlay);
    };

    // Append elements to the popup
    popup.appendChild(studentLabel);
    popup.appendChild(studentInput);
    popup.appendChild(classLabel);
    popup.appendChild(classInput);
    popup.appendChild(submitButton);
    popup.appendChild(cancelButton);

    // Center the popup on the screen
    var popupWidth = 300; // Adjust the width as needed
    var popupHeight = 200; // Adjust the height as needed
    popup.style.left = (window.innerWidth - popupWidth) / 2 + "px";
    popup.style.top = (window.innerHeight - popupHeight) / 2 + "px";

    // Make overlay and popup visible
    overlay.style.display = "block";
    popup.style.display = "block";
}
    document.getElementById("addStudentButton").addEventListener("click", openAddStudentPopup);
</script>
    
   <br>

    <div style="text-align: center;">
        <button class="btn btn-primary rounded-button" onclick="downloadList()">Download List</button>
    </div>
</body>
<footer>
   
</footer>
</html>
